"use strict";function WebAudioTinySynth(a){this.__proto__=this.sy={is:"webaudio-tinysynth",properties:{masterVol:{type:Number,value:.5,observer:"setMasterVol"},reverbLev:{type:Number,value:.3,observer:"setReverbLev"},quality:{type:Number,value:1,observer:"setQuality"},debug:{type:Number,value:0},src:{type:String,value:null,observer:"loadMIDIUrl"},loop:{type:Number,value:0},internalcontext:{type:Number,value:1},tsmode:{type:Number,value:0},voices:{type:Number,value:64},useReverb:{type:Number,value:1}},program:[{name:"Acoustic Grand Piano"},{name:"Bright Acoustic Piano"},{name:"Electric Grand Piano"},{name:"Honky-tonk Piano"},{name:"Electric Piano 1"},{name:"Electric Piano 2"},{name:"Harpsichord"},{name:"Clavi"},{name:"Celesta"},{name:"Glockenspiel"},{name:"Music Box"},{name:"Vibraphone"},{name:"Marimba"},{name:"Xylophone"},{name:"Tubular Bells"},{name:"Dulcimer"},{name:"Drawbar Organ"},{name:"Percussive Organ"},{name:"Rock Organ"},{name:"Church Organ"},{name:"Reed Organ"},{name:"Accordion"},{name:"Harmonica"},{name:"Tango Accordion"},{name:"Acoustic Guitar (nylon)"},{name:"Acoustic Guitar (steel)"},{name:"Electric Guitar (jazz)"},{name:"Electric Guitar (clean)"},{name:"Electric Guitar (muted)"},{name:"Overdriven Guitar"},{name:"Distortion Guitar"},{name:"Guitar harmonics"},{name:"Acoustic Bass"},{name:"Electric Bass (finger)"},{name:"Electric Bass (pick)"},{name:"Fretless Bass"},{name:"Slap Bass 1"},{name:"Slap Bass 2"},{name:"Synth Bass 1"},{name:"Synth Bass 2"},{name:"Violin"},{name:"Viola"},{name:"Cello"},{name:"Contrabass"},{name:"Tremolo Strings"},{name:"Pizzicato Strings"},{name:"Orchestral Harp"},{name:"Timpani"},{name:"String Ensemble 1"},{name:"String Ensemble 2"},{name:"SynthStrings 1"},{name:"SynthStrings 2"},{name:"Choir Aahs"},{name:"Voice Oohs"},{name:"Synth Voice"},{name:"Orchestra Hit"},{name:"Trumpet"},{name:"Trombone"},{name:"Tuba"},{name:"Muted Trumpet"},{name:"French Horn"},{name:"Brass Section"},{name:"SynthBrass 1"},{name:"SynthBrass 2"},{name:"Soprano Sax"},{name:"Alto Sax"},{name:"Tenor Sax"},{name:"Baritone Sax"},{name:"Oboe"},{name:"English Horn"},{name:"Bassoon"},{name:"Clarinet"},{name:"Piccolo"},{name:"Flute"},{name:"Recorder"},{name:"Pan Flute"},{name:"Blown Bottle"},{name:"Shakuhachi"},{name:"Whistle"},{name:"Ocarina"},{name:"Lead 1 (square)"},{name:"Lead 2 (sawtooth)"},{name:"Lead 3 (calliope)"},{name:"Lead 4 (chiff)"},{name:"Lead 5 (charang)"},{name:"Lead 6 (voice)"},{name:"Lead 7 (fifths)"},{name:"Lead 8 (bass + lead)"},{name:"Pad 1 (new age)"},{name:"Pad 2 (warm)"},{name:"Pad 3 (polysynth)"},{name:"Pad 4 (choir)"},{name:"Pad 5 (bowed)"},{name:"Pad 6 (metallic)"},{name:"Pad 7 (halo)"},{name:"Pad 8 (sweep)"},{name:"FX 1 (rain)"},{name:"FX 2 (soundtrack)"},{name:"FX 3 (crystal)"},{name:"FX 4 (atmosphere)"},{name:"FX 5 (brightness)"},{name:"FX 6 (goblins)"},{name:"FX 7 (echoes)"},{name:"FX 8 (sci-fi)"},{name:"Sitar"},{name:"Banjo"},{name:"Shamisen"},{name:"Koto"},{name:"Kalimba"},{name:"Bag pipe"},{name:"Fiddle"},{name:"Shanai"},{name:"Tinkle Bell"},{name:"Agogo"},{name:"Steel Drums"},{name:"Woodblock"},{name:"Taiko Drum"},{name:"Melodic Tom"},{name:"Synth Drum"},{name:"Reverse Cymbal"},{name:"Guitar Fret Noise"},{name:"Breath Noise"},{name:"Seashore"},{name:"Bird Tweet"},{name:"Telephone Ring"},{name:"Helicopter"},{name:"Applause"},{name:"Gunshot"}],drummap:[{name:"Acoustic Bass Drum"},{name:"Bass Drum 1"},{name:"Side Stick"},{name:"Acoustic Snare"},{name:"Hand Clap"},{name:"Electric Snare"},{name:"Low Floor Tom"},{name:"Closed Hi Hat"},{name:"High Floor Tom"},{name:"Pedal Hi-Hat"},{name:"Low Tom"},{name:"Open Hi-Hat"},{name:"Low-Mid Tom"},{name:"Hi-Mid Tom"},{name:"Crash Cymbal 1"},{name:"High Tom"},{name:"Ride Cymbal 1"},{name:"Chinese Cymbal"},{name:"Ride Bell"},{name:"Tambourine"},{name:"Splash Cymbal"},{name:"Cowbell"},{name:"Crash Cymbal 2"},{name:"Vibraslap"},{name:"Ride Cymbal 2"},{name:"Hi Bongo"},{name:"Low Bongo"},{name:"Mute Hi Conga"},{name:"Open Hi Conga"},{name:"Low Conga"},{name:"High Timbale"},{name:"Low Timbale"},{name:"High Agogo"},{name:"Low Agogo"},{name:"Cabasa"},{name:"Maracas"},{name:"Short Whistle"},{name:"Long Whistle"},{name:"Short Guiro"},{name:"Long Guiro"},{name:"Claves"},{name:"Hi Wood Block"},{name:"Low Wood Block"},{name:"Mute Cuica"},{name:"Open Cuica"},{name:"Mute Triangle"},{name:"Open Triangle"}],program1:[[{w:"sine",v:.4,d:.7,r:.1},{w:"triangle",v:3,d:.7,s:.1,g:1,a:.01,k:-1.2}],[{w:"triangle",v:.4,d:.7,r:.1},{w:"triangle",v:4,t:3,d:.4,s:.1,g:1,k:-1,a:.01}],[{w:"sine",d:.7,r:.1},{w:"triangle",v:4,f:2,d:.5,s:.5,g:1,k:-1}],[{w:"sine",d:.7,v:.2},{w:"triangle",v:4,t:3,f:2,d:.3,g:1,k:-1,a:.01,s:.5}],[{w:"sine",v:.35,d:.7},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],[{w:"sine",v:.35,d:.7},{w:"sine",v:11,t:7,f:1,d:.5,s:1,g:1,k:-.7}],[{w:"sawtooth",v:.34,d:2},{w:"sine",v:8,f:.1,d:2,s:1,r:2,g:1}],[{w:"triangle",v:.34,d:1.5},{w:"square",v:6,f:.1,d:1.5,s:.5,r:2,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:11,t:6,d:.2,s:.4,g:1}],[{w:"sine",v:.2,d:.3,r:.3},{w:"sine",v:11,t:5,d:.1,s:.4,g:1}],[{w:"sine",v:.2,d:.6,r:.6},{w:"triangle",v:11,t:5,f:1,s:.5,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:6,t:5,d:.02,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.2,d:1,r:1},{w:"sine",v:11,t:3.5,d:1,r:1,g:1}],[{w:"triangle",v:.2,d:.5,r:.2},{w:"sine",v:6,t:2.5,d:.2,s:.1,r:.2,g:1}],[{w:"w9999",v:.3,s:.9},{w:"w9999",v:.3,t:2,f:2,s:.9}],[{w:"w9999",v:.2,s:1},{w:"sine",v:11,t:6,f:2,s:.1,g:1,h:.006,r:.002,d:.002},{w:"w9999",v:.2,t:2,f:1,h:0,s:1}],[{w:"w9999",v:.27,d:.1,s:.9},{w:"w9999",v:.3,t:4,f:2,s:.5}],[{w:"w9999",v:.3,a:.04,s:.9},{w:"w9999",v:.2,t:8,f:2,a:.04,s:.9}],[{w:"sine",v:.2,a:.02,d:.05,s:1},{w:"sine",v:6,t:3,f:1,a:.02,d:.05,s:1,g:1}],[{w:"triangle",v:.2,a:.02,d:.05,s:.8},{w:"square",v:7,t:3,f:1,d:.05,s:1.5,g:1}],[{w:"square",v:.2,a:.02,d:.2,s:.5},{w:"square",v:1,d:.03,s:2,g:1}],[{w:"square",v:.2,a:.02,d:.1,s:.8},{w:"square",v:1,a:.3,d:.1,s:2,g:1}],[{w:"triangle",v:.3,d:.5},{w:"triangle",v:5,t:3,f:1.5,d:1,s:.1,g:1}],[{w:"triangle",v:.4,d:.6},{w:"triangle",v:8,t:1.001,d:1,s:1,g:1}],[{w:"triangle",v:.3,d:1},{w:"triangle",v:6,f:2,d:.4,s:.5,g:1}],[{w:"sine",v:.3,d:1},{w:"triangle",v:6,f:1,d:.4,s:.5,g:1}],[{w:"sine",v:.4,d:.1},{w:"sine",v:7,g:1}],[{w:"triangle",v:.35,d:1},{w:"square",v:7,f:2,d:.3,s:.5,g:1}],[{w:"triangle",v:.4,d:1},{w:"square",v:4,f:2,d:1,s:.7,g:1}],[{w:"sine",v:.2,t:1.5,a:.005,h:.2,d:.6},{w:"sine",v:11,t:5,f:2,d:1,s:.5,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"w9999",d:.3,v:.7,s:.5},{w:"sawtooth",v:1.2,d:.02,s:.5,g:1,h:0,r:.02}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sine",v:.4,a:.1,d:11},{w:"sine",v:6,f:2.5,d:.05,s:1.1,g:1}],[{w:"sine",v:.3,d:.1,r:.1},{w:"square",v:4,t:3,d:1,s:.2,g:1}],[{w:"sine",v:.3,d:.5,r:.5},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1}],[{w:"triangle",v:.6,h:.03,d:.3,r:.3,t:.5},{w:"n0",v:8,t:1.5,d:.08,r:.08,g:1}],[{w:"sawtooth",v:.3,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.3,f:-2,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,t:2,f:2,a:1,d:1,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,f:2,a:.02,d:1,s:1}],[{w:"triangle",v:.3,a:.03,s:1},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1}],[{w:"sine",v:.4,a:.03,s:.9},{w:"sine",v:1,t:2,f:3,d:.03,s:.2,g:1}],[{w:"triangle",v:.6,a:.05,s:.5},{w:"sine",v:1,f:.8,d:.2,s:.2,g:1}],[{w:"square",v:.15,a:.01,d:.2,r:.2,t:.5,h:.03},{w:"square",v:4,f:.5,d:.2,r:11,a:.01,g:1,h:.02},{w:"square",v:.15,t:4,f:1,a:.02,d:.15,r:.15,h:.03},{g:3,w:"square",v:4,f:-.5,a:.01,h:.02,d:.15,r:11}],[{w:"square",v:.2,a:.01,d:1,s:.6,r:.04},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.04,d:1,s:.4,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.15,a:.04,s:1},{w:"sine",v:2,d:.1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6,r:.08},{w:"sine",v:1,f:.2,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:.5,s:.7,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"sine",v:.4,a:.02,d:.7,s:.5},{w:"square",v:5,t:2,d:.2,s:.5,g:1}],[{w:"sine",v:.3,a:.05,d:.2,s:.8},{w:"sawtooth",v:6,f:.1,d:.1,s:.3,g:1}],[{w:"sine",v:.3,a:.03,d:.2,s:.4},{w:"square",v:7,f:.2,d:1,s:.1,g:1}],[{w:"square",v:.2,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",a:.02,d:2},{w:"sine",v:6,t:2,d:.04,g:1}],[{w:"sine",v:.7,a:.03,d:.4,s:.4},{w:"sine",v:4,t:2,f:.2,d:.4,g:1}],[{w:"sine",v:.7,a:.02,d:.4,s:.6},{w:"sine",v:3,t:2,d:.05,s:.1,g:1}],[{w:"sine",v:.4,a:.06,d:.3,s:.3},{w:"sine",v:7,t:2,d:.2,s:.2,g:1}],[{w:"sine",a:.02,d:.3,s:.3},{w:"sawtooth",v:3,t:2,d:.3,g:1}],[{w:"sine",v:.4,a:.02,d:2,s:.1},{w:"sawtooth",v:8,t:2,f:1,d:.5,g:1}],[{w:"sine",v:.7,a:.03,d:.5,s:.3},{w:"sine",v:.003,t:0,f:4,d:.1,s:.002,g:1}],[{w:"sine",v:.7,a:.02,d:2},{w:"sine",v:1,t:2,f:1,d:.02,g:1}],[{w:"square",v:.3,d:1,s:.5},{w:"square",v:1,f:.2,d:1,s:.5,g:1}],[{w:"sawtooth",v:.3,d:2,s:.5},{w:"square",v:2,f:.1,s:.5,g:1}],[{w:"triangle",v:.5,a:.05,d:2,s:.6},{w:"sine",v:4,t:2,g:1}],[{w:"triangle",v:.3,a:.01,d:2,s:.3},{w:"sine",v:22,t:2,f:1,d:.03,s:.2,g:1}],[{w:"sawtooth",v:.3,d:1,s:.5},{w:"sine",v:11,t:11,a:.2,d:.05,s:.3,g:1}],[{w:"sine",v:.3,a:.06,d:1,s:.5},{w:"sine",v:7,f:1,d:1,s:.2,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:11,f:1,d:.5,g:1}],[{w:"triangle",v:.3,a:.01,d:.7,s:.5},{w:"square",v:5,t:.5,d:.7,s:.5,g:1}],[{w:"triangle",v:.3,a:.02,d:.3,s:.3,r:.3},{w:"square",v:3,t:4,f:1,a:.02,d:.1,s:1,g:1},{w:"triangle",v:.08,t:.5,a:.1,h:0,d:.1,s:.5,r:.1,b:0,c:0}],[{w:"sine",v:.3,a:.05,d:1,s:.7,r:.3},{w:"sine",v:2,f:1,d:.3,s:1,g:1}],[{w:"square",v:.3,a:.03,d:.5,s:.3,r:.1},{w:"square",v:4,f:1,a:.03,d:.1,g:1}],[{w:"triangle",v:.3,a:.08,d:1,s:.3,r:.1},{w:"square",v:2,f:1,d:.3,s:.3,g:1,t:4,a:.08}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sine",v:.1,t:2.001,f:1,d:1,s:50,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:7,f:1,d:.5,s:1.7,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sawtooth",v:22,t:6,d:.06,s:.3,g:1}],[{w:"triangle",v:.3,a:.05,d:11,r:.3},{w:"triangle",v:1,d:1,s:8,g:1}],[{w:"sawtooth",v:.3,d:4,s:.8,r:.1},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:.1,g:1}],[{w:"triangle",v:.3,d:1,s:.5,t:.8,a:.2,p:1.25,q:.2},{w:"sawtooth",v:.2,a:.2,d:.3,s:1,t:1.2,p:1.25,q:.2}],[{w:"sine",v:.3,d:1,s:.3},{w:"square",v:22,t:11,d:.5,s:.1,g:1}],[{w:"sawtooth",v:.3,a:.04,d:1,s:.8,r:.1},{w:"square",v:1,t:.5,d:1,s:2,g:1}],[{w:"triangle",v:.3,d:1,s:.3},{w:"sine",v:22,t:6,d:.6,s:.05,g:1}],[{w:"sine",v:.6,a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"sine",a:.1,d:.05,s:.4,v:.8},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"square",v:.3,a:.1,d:.1,s:.4},{w:"square",v:1,f:1,d:.3,s:.1,g:1}],[{w:"sawtooth",v:.3,d:.5,r:.5},{w:"sawtooth",v:11,t:5,d:.05,g:1}],[{w:"square",v:.3,d:.2,r:.2},{w:"square",v:7,t:3,d:.05,g:1}],[{w:"triangle",d:.2,r:.2},{w:"square",v:9,t:3,d:.1,r:.1,g:1}],[{w:"triangle",d:.3,r:.3},{w:"square",v:6,t:3,d:1,r:1,g:1}],[{w:"triangle",v:.4,d:.2,r:.2},{w:"square",v:22,t:12,d:.1,r:.1,g:1}],[{w:"sine",v:.25,a:.02,d:.05,s:.8},{w:"square",v:1,t:2,d:.03,s:11,g:1}],[{w:"sine",v:.3,a:.05,d:11},{w:"square",v:7,t:3,f:1,s:.7,g:1}],[{w:"square",v:.3,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",v:.4,d:.3,r:.3},{w:"sine",v:7,t:9,d:.1,r:.1,g:1}],[{w:"sine",v:.7,d:.1,r:.1},{w:"sine",v:22,t:7,d:.05,g:1}],[{w:"sine",v:.6,d:.15,r:.15},{w:"square",v:11,t:3.2,d:.1,r:.1,g:1}],[{w:"sine",v:.8,d:.07,r:.07},{w:"square",v:11,t:7,r:.01,g:1}],[{w:"triangle",v:.7,t:.5,d:.2,r:.2,p:.95},{w:"n0",v:9,g:1,d:.2,r:.2}],[{w:"sine",v:.7,d:.1,r:.1,p:.9},{w:"square",v:14,t:2,d:.005,r:.005,g:1}],[{w:"square",d:.15,r:.15,p:.5},{w:"square",v:4,t:5,d:.001,r:.001,g:1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"sine",t:0,f:3322,d:0,r:0,p:1.3,v:.3,h:.03},{g:1,w:"square",v:1,t:0,f:52,d:0,r:0,p:2}],[{w:"n0",v:.2,a:.05,h:.02,d:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.1,d:1,s:.5},{w:"sawtooth",v:6,t:0,f:8,d:1,s:1,r:.1,g:1}],[{w:"square",v:.3,t:.25,d:11,s:1},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1}],[{w:"n0",v:.4,t:.5,a:1,d:11,s:1,r:.5},{w:"square",v:1,t:0,f:14,d:1,s:1,r:11,g:1}],[{w:"sine",t:0,f:1221,a:.2,d:1,r:.25,s:1},{g:1,w:"n0",v:3,t:.5,d:1,s:1,r:1}],[{w:"sine",d:.4,r:.4,p:.1,t:2.5,v:1},{w:"n0",v:12,t:2,d:1,r:1,g:1}]],program0:[[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sine",v:.5,d:.3,r:.3}],[{w:"triangle",v:.5,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"square",v:.2,d:1,r:1}],[{w:"sawtooth",v:.3,d:.7,r:.7}],[{w:"sine",v:.5,a:.01,s:1}],[{w:"sine",v:.7,d:.02,s:.7}],[{w:"square",v:.2,s:1}],[{w:"triangle",v:.5,a:.01,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.05,s:1}],[{w:"triangle",v:.5,d:.5}],[{w:"square",v:.2,d:.6}],[{w:"square",v:.2,d:.6}],[{w:"triangle",v:.8,d:.6}],[{w:"triangle",v:.4,d:.05}],[{w:"square",v:.2,d:1}],[{w:"square",v:.2,d:1}],[{w:"sine",v:.4,d:.6}],[{w:"triangle",v:.7,d:.4}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.1,s:.2}],[{w:"sawtooth",v:.4,d:.1,s:.2}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.3,d:.1}],[{w:"sawtooth",v:.3,d:.5,r:.5}],[{w:"triangle",v:.6,d:.1,r:.1,h:.03,p:.8}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"triangle",v:.3,a:.03,s:1}],[{w:"sine",v:.3,a:.03,s:1}],[{w:"triangle",v:.3,a:.05,s:1}],[{w:"sawtooth",v:.5,a:.01,d:.1}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.2,a:.05,d:.01,s:1}],[{w:"square",v:.3,a:.05,s:1}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.04,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.05,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"square",v:.3,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"triangle",v:.5,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"sawtooth",v:.4,d:12}],[{w:"sine",v:.4,a:.06,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.3,d:12}],[{w:"triangle",v:.5,d:12}],[{w:"square",v:.3,d:12}],[{w:"triangle",v:.5,a:.08,d:11}],[{w:"sawtooth",v:.5,a:.05,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.5,a:.04,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,a:.8,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.3,d:1,r:1}],[{w:"sawtooth",v:.5,d:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"square",v:.3,d:.2,r:.2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"sawtooth",v:.2,a:.02,d:.7}],[{w:"triangle",v:.5,d:1}],[{w:"sawtooth",v:.3,d:.3,r:.3}],[{w:"sine",v:.8,d:.1,r:.1}],[{w:"square",v:.2,d:.1,r:.1,p:1.05}],[{w:"sine",v:.8,d:.05,r:.05}],[{w:"triangle",v:.5,d:.1,r:.1,p:.96}],[{w:"triangle",v:.5,d:.1,r:.1,p:.97}],[{w:"square",v:.3,d:.1,r:.1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"triangle",v:.5,d:.03,t:0,f:1332,r:.001,p:1.1}],[{w:"n0",v:.2,t:.1,d:.02,a:.05,h:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.8,d:1,t:0,f:1832}],[{w:"triangle",d:.5,t:0,f:444,s:1}],[{w:"n0",v:.4,d:1,t:0,f:22,s:1}],[{w:"n0",v:.5,a:.2,d:11,t:0,f:44}],[{w:"n0",v:.5,t:.25,d:.4,r:.4}]],drummap1:[[{w:"triangle",t:0,f:66,v:1,d:.02,h:.03,p:.9,r:.02},{w:"square",g:1,t:10.1,v:22,r:.002,h:0,p:0,d:.002}],[{w:"triangle",t:0,f:66,v:1,d:.02,h:.03,p:.9,r:.02},{w:"square",g:1,t:10.1,v:22,r:.002,h:0,p:0,d:.002}],[{w:"n0",f:222,p:0,t:0,r:.01,h:0}],[{w:"triangle",v:.3,f:180,d:.05,t:0,h:.03,p:.9,q:.1},{w:"n0",v:.6,t:0,f:70,h:.02,r:.01,p:0},{g:1,w:"square",v:2,t:0,f:360,r:.01,b:0,c:0}],[{w:"square",f:1150,v:.34,t:0,r:.03,h:.025,d:.03},{g:1,w:"n0",t:0,f:13,h:.025,d:.1,s:1,r:.1,v:1}],[{w:"triangle",f:200,v:1,d:.06,t:0,r:.06},{w:"n0",g:1,t:0,f:400,v:12,r:.02,d:.02}],[{w:"triangle",f:200,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.4,h:.015,d:.005,r:.005}],[{w:"n1",f:390,v:.25,r:.01,t:0}],[{w:"triangle",f:200,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.5,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,r:.03,t:0,h:.005,d:.03}],[{w:"triangle",f:250,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,t:0,d:.2,r:.2},{w:"n0",v:.3,t:0,c:0,f:440,h:.005,d:.05}],[{w:"triangle",f:320,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"triangle",f:360,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],[{w:"triangle",f:420,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",f:500,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.1,t:0,r:.01,f:440}],[{w:"n1",v:.3,f:800,d:.2,r:.2,h:.05,t:0,p:1.1},{w:"n1",t:0,v:1,d:.1,r:.1,p:2,f:440}],[{w:"sine",f:1651,v:.15,d:.2,r:.2,h:0,t:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,h:1},{g:1,w:"n0",v:3.1,t:.152,d:.002,r:.002}],null,[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],null,[{w:"n1",v:.3,f:555,d:.25,r:.25,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,f:440,a:.005,h:.02}],[{w:"n1",f:11,v:.7,d:.3,t:0,r:.3},{g:1,w:"square",v:6,t:0,f:18,a:.005,h:.02,d:.1,s:1,r:.1,c:0}],[{w:"n1",f:440,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.4,t:0,r:.01,f:440}],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[{w:"sine",f:1720,v:.3,d:.02,t:0,r:.02},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}],[{w:"sine",f:1720,v:.3,d:.25,t:0,r:.25},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}]],drummap0:[[{w:"triangle",t:0,f:110,v:1,d:.05,h:.02,p:.1}],[{w:"triangle",t:0,f:150,v:.8,d:.1,p:.1,h:.02,r:.01}],[{w:"n0",f:392,v:.5,d:.01,p:0,t:0,r:.05}],[{w:"n0",f:33,d:.05,t:0}],[{w:"n0",f:100,v:.7,d:.03,t:0,r:.03,h:.02}],[{w:"n0",f:44,v:.7,d:.02,p:.1,t:0,h:.02}],[{w:"triangle",f:240,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,r:.01,t:0}],[{w:"triangle",f:270,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.04,r:.04,t:0}],[{w:"triangle",f:300,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.1,r:.1,h:.02,t:0}],[{w:"triangle",f:320,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"triangle",f:360,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.1,h:.05,t:0,p:.1}],[{w:"triangle",f:400,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:440,v:.3,d:.1,p:.9,t:0,r:.1}],[{w:"n0",f:200,v:.2,d:.05,p:.9,t:0}],[{w:"n0",f:440,v:.3,d:.12,p:.9,t:0}],[{w:"sine",f:800,v:.4,d:.06,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:33,v:.3,d:.2,p:.9,t:0}],[{w:"n0",f:300,v:.3,d:.14,p:.9,t:0}],[{w:"sine",f:200,d:.06,t:0}],[{w:"sine",f:150,d:.06,t:0}],[{w:"sine",f:300,t:0}],[{w:"sine",f:300,d:.06,t:0}],[{w:"sine",f:250,d:.06,t:0}],[{w:"square",f:300,v:.3,d:.06,p:.8,t:0}],[{w:"square",f:260,v:.3,d:.06,p:.8,t:0}],[{w:"sine",f:850,v:.5,d:.07,t:0}],[{w:"sine",f:790,v:.5,d:.07,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"triangle",f:1800,v:.4,p:.9,t:0,h:.03}],[{w:"triangle",f:1800,v:.3,p:.9,t:0,h:.13}],[{w:"n0",f:330,v:.3,a:.02,t:0,r:.01}],[{w:"n0",f:330,v:.3,a:.02,t:0,h:.04,r:.01}],[{w:"n0",f:440,v:.3,t:0}],[{w:"sine",f:800,t:0}],[{w:"sine",f:700,t:0}],[{w:"n0",f:330,v:.3,t:0}],[{w:"n0",f:330,v:.3,t:0,h:.1,r:.01,p:.7}],[{w:"sine",t:0,f:1200,v:.3,r:.01}],[{w:"sine",t:0,f:1200,v:.3,d:.2,r:.2}]],ready:function(){var a;this.pg=[],this.vol=[],this.ex=[],this.bend=[],this.rpnidx=[],this.brange=[],this.sustain=[],this.notetab=[],this.maxTick=0,this.playTick=0,this.playing=0,this.releaseRatio=3;for(var a=0;a<16;++a)this.pg[a]=0,this.vol[a]=3e4/16129,this.bend[a]=0,this.brange[a]=256;this.preroll=.2,this.relcnt=0,setInterval(function(){if(++this.relcnt>=3){this.relcnt=0;for(var a=this.notetab.length-1;a>=0;--a){var b=this.notetab[a];this.actx.currentTime>b.e&&(this._pruneNote(b),this.notetab.splice(a,1))}}if(this.playing&&this.song.ev.length>0)for(var c=this.song.ev[this.playIndex];this.actx.currentTime+this.preroll>this.playTime;)if(65361==c.m[0]?(this.song.tempo=c.m[1],this.tick2Time=240/this.song.tempo/this.song.timebase):this.send(c.m,this.playTime),++this.playIndex,this.playIndex>=this.song.ev.length){if(!this.loop){this.playTick=this.maxTick,this.playing=0;break}c=this.song.ev[this.playIndex=0],this.playTick=c.t}else c=this.song.ev[this.playIndex],this.playTime+=(c.t-this.playTick)*this.tick2Time,this.playTick=c.t}.bind(this),60),console.log("internalcontext:"+this.internalcontext),this.internalcontext&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.setAudioContext(new AudioContext)),this.isReady=1},setMasterVol:function(a){void 0!=a&&(this.masterVol=a),this.out&&(this.out.gain.value=this.masterVol)},setReverbLev:function(a){void 0!=a&&(this.reverbLev=a);var b=parseFloat(this.reverbLev);this.rev&&!isNaN(b)&&(this.rev.gain.value=8*b)},setLoop:function(a){this.loop=a},setVoices:function(a){this.voices=a},getPlayStatus:function(){return{play:this.playing,maxTick:this.maxTick,curTick:this.playTick}},locateMIDI:function(a){var b,c=this.playing;for(this.stopMIDI(),b=0;b<this.song.ev.length&&a>this.song.ev[b].t;++b){var d=this.song.ev[b],e=15&d.m[0];switch(240&d.m[0]){case 176:switch(d.m[1]){case 1:this.setModulation(e,d.m[2]);break;case 7:this.setChVol(e,d.m[2]);break;case 10:this.setPan(e,d.m[2]);break;case 11:this.setExpression(e,d.m[2]);break;case 64:this.setSustain(e,d.m[2])}break;case 192:this.pg[15&d.m[0]]=d.m[1]}65361==d.m[0]&&(this.song.tempo=d.m[1])}this.song.ev[b]?(this.playIndex=b,this.playTick=this.song.ev[b].t):(this.playIndex=0,this.playTick=this.maxTick),c&&this.playMIDI()},getTimbreName:function(a,b){return 0==a?this.program[b].name:this.drummap[b-35].name},loadMIDIUrl:function(a){if(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.responseType="arraybuffer",b.loadMIDI=this.loadMIDI.bind(this),b.onload=function(a){200==this.status&&this.loadMIDI(this.response)},b.send()}},reset:function(){for(var a=0;a<16;++a)this.setProgram(a,0),this.setBendRange(a,256),this.setChVol(a,100),this.setPan(a,64),this.resetAllControllers(a),this.allSoundOff(a)},stopMIDI:function(){this.playing=0;for(var a=0;a<16;++a)this.allSoundOff(a)},playMIDI:function(){if(this.song){var a=this.actx.createOscillator();a.connect(this.actx.destination),a.frequency.value=0,a.start(0),a.stop(this.actx.currentTime+.001),this.playTick>=this.maxTick&&(this.playTick=0,this.playIndex=0),this.playTime=this.actx.currentTime+.1,this.tick2Time=240/this.song.tempo/this.song.timebase,this.playing=1}},loadMIDI:function(a){function b(a,b){return(a[b]<<8)+a[b+1]}function c(a,b){return(a[b]<<16)+(a[b+1]<<8)+a[b+2]}function d(a,b){return(a[b]<<24)+(a[b+1]<<16)+(a[b+2]<<8)+a[b+3]}function e(a,b,c){return String.fromCharCode.apply(null,a.slice(b,b+c))}function f(a,b){var c,d;for(c=0,i=1;128&(d=a[b]);)c=(c<<7)+(127&d),++i,++b;return(c<<7)+d}function g(a,b,d,g){var h=d[g];switch(i=1,0==(128&h)&&(h=k,i=0),k=h,240&h){case 192:case 208:a.ev.push({t:b,m:[h,d[g+i]]}),i+=1;break;case 240:switch(h){case 255:var l=f(d,g+2);switch(j=2+i,i=l+i+2,d[g+1]){case 2:a.copyright+=e(d,g+j,i-3);break;case 1:case 3:case 4:case 9:a.text=e(d,g+j,i-j);break;case 47:return 1;case 81:var m=Math.floor(6e7/c(d,g+3));a.ev.push({t:b,m:[65361,m]})}}break;default:a.ev.push({t:b,m:[h,d[g+i],d[g+i+1]]}),i+=2}return 0}this.stopMIDI();var h=new Uint8Array(a),i=0,j=0,k=144,l=0,m=h.slice(0,4);if("77,84,104,100"==m.toString()){var n=d(h,4),o=(b(h,8),b(h,10));this.maxTick=0;var p=4*b(h,12);l=n+8,this.song={copyright:"",text:"",tempo:120,timebase:p,ev:[]};for(var q=0;q<o;++q){if(m=h.slice(l,l+4),n=d(h,l+4),"77,84,114,107"==m.toString()){var r=0,s=0;for(this.notetab.length=0;;){r+=f(h,l+8+s),s+=i;var t=g(this.song,r,h,l+8+s);if(s+=i,t)break}r>this.maxTick&&(this.maxTick=r)}l+=n+8}this.song.ev.sort(function(a,b){return a.t-b.t}),this.reset(),this.locateMIDI(0)}},setQuality:function(a){var b;for(void 0!=a&&(this.quality=a),b=0;b<128;++b)this.setTimbre(0,b,this.program0[b]);for(b=0;b<this.drummap0.length;++b)this.setTimbre(1,b+35,this.drummap0[b]);if(this.quality){for(b=0;b<this.program1.length;++b)this.setTimbre(0,b,this.program1[b]);for(b=0;b<this.drummap.length;++b)this.drummap1[b]&&this.setTimbre(1,b+35,this.drummap1[b])}},setTimbre:function(a,c,d){function e(a){for(c=0;c<a.length;++c)for(b in f)a[c].hasOwnProperty(b)&&"undefined"!=typeof a[c][b]||(a[c][b]=f[b]);return a}var f={g:0,w:"sine",t:1,f:0,v:.5,a:0,h:.01,d:.01,s:0,r:.05,p:1,q:1,k:0};a&&c>=35&&c<=81&&(this.drummap[c-35].p=e(d)),0==a&&c>=0&&c<=127&&(this.program[c].p=e(d))},_pruneNote:function(a){for(var b=a.o.length-1;b>=0;--b)a.o[b].frequency&&this.chmod[a.ch].disconnect(a.o[b].detune),a.o[b].disconnect(),a.o[b].frequency?a.o[b].frequency.cancelScheduledValues(0):a.o[b].playbackRate.cancelScheduledValues(0),a.o[b].stop(0);for(var b=a.g.length-1;b>=0;--b)a.g[b].disconnect(),a.g[b].gain.cancelScheduledValues(0)},_limitVoices:function(a,b){this.notetab.sort(function(a,b){return a.f!=b.f?a.f-b.f:a.e!=b.e?b.e-a.e:b.t-a.t});for(var c=this.notetab.length-1;c>=0;--c){var d=this.notetab[c];(this.actx.currentTime>d.e||c>=this.voices-1)&&(this._pruneNote(d),this.notetab.splice(c,1))}},_note:function(a,b,c,d,e){var f,g,h,i,j=[],k=[],l=[],m=[],n=[],o=440*Math.pow(2,(c-69)/12);for(this._limitVoices(b,c),f=0;f<e.length;++f){i=e[f];var p=a+i.a+i.h;switch(0==i.g?(g=this.chvol[b],h=d*d/16384,m[f]=o*i.t+i.f):j[i.g-1].frequency?(g=j[i.g-1].frequency,h=m[i.g-1],m[f]=m[i.g-1]*i.t+i.f):(g=j[i.g-1].playbackRate,h=m[i.g-1]/440,m[f]=m[i.g-1]*i.t+i.f),i.w[0]){case"n":j[f]=this.actx.createBufferSource(),j[f].buffer=this.noiseBuf[i.w],j[f].loop=!0,j[f].playbackRate.value=m[f]/440,1!=i.p&&this._setParamTarget(j[f].playbackRate,m[f]/440*i.p,a,i.q);break;default:j[f]=this.actx.createOscillator(),j[f].frequency.value=m[f],1!=i.p&&this._setParamTarget(j[f].frequency,m[f]*i.p,a,i.q),"w"==i.w[0]?j[f].setPeriodicWave(this.wave[i.w]):j[f].type=i.w,this.chmod[b].connect(j[f].detune),j[f].detune.value=this.bend[b]}k[f]=this.actx.createGain(),n[f]=i.r,j[f].connect(k[f]),k[f].connect(g),l[f]=h*i.v,i.k&&(l[f]*=Math.pow(2,(c-60)/12*i.k)),i.a?(k[f].gain.value=0,k[f].gain.setValueAtTime(0,a),k[f].gain.linearRampToValueAtTime(l[f],a+i.a)):k[f].gain.setValueAtTime(l[f],a),this._setParamTarget(k[f].gain,i.s*l[f],p,i.d),j[f].start(a),9==b&&j[f].stop(a+e[0].d*this.releaseRatio)}9!=b&&this.notetab.push({t:a,e:99999,ch:b,n:c,o:j,g:k,t2:a+i.a,v:l,r:n,f:0})},_setParamTarget:function(a,b,c,d){0!=d?a.setTargetAtTime(b,c,d):a.setValueAtTime(b,c)},_releaseNote:function(a,b){if(9!=a.ch)for(var c=a.g.length-1;c>=0;--c)a.g[c].gain.cancelScheduledValues(b),b==a.t2?a.g[c].gain.setValueAtTime(a.v[c],b):b<a.t2&&a.g[c].gain.setValueAtTime(a.v[c]*(b-a.t)/(a.t2-a.t),b),this._setParamTarget(a.g[c].gain,0,b,a.r[c]);a.e=b+a.r[0]*this.releaseRatio,a.f=1},setModulation:function(a,b,c){this.chmod[a].gain.setValueAtTime(100*b/127,this._tsConv(c))},setChVol:function(a,b,c){this.vol[a]=3*b*b/16129,this.chvol[a].gain.setValueAtTime(this.vol[a]*this.ex[a],this._tsConv(c))},setPan:function(a,b,c){this.chpan[a]&&this.chpan[a].pan.setValueAtTime((b-64)/64,this._tsConv(c))},setExpression:function(a,b,c){this.ex[a]=b*b/16129,this.chvol[a].gain.setValueAtTime(this.vol[a]*this.ex[a],this._tsConv(c))},setSustain:function(a,b,c){if(this.sustain[a]=b,c=this._tsConv(c),b<64)for(var d=this.notetab.length-1;d>=0;--d){var e=this.notetab[d];c>=e.t&&e.ch==a&&1==e.f&&this._releaseNote(e,c)}},allSoundOff:function(a){for(var b=this.notetab.length-1;b>=0;--b){var c=this.notetab[b];c.ch==a&&(this._pruneNote(c),this.notetab.splice(b,1))}},resetAllControllers:function(a){this.bend[a]=0,this.ex[a]=1,this.rpnidx[a]=16383,this.sustain[a]=0,this.chvol[a]&&(this.chvol[a].gain.value=this.vol[a]*this.ex[a],this.chmod[a].gain.value=0)},setBendRange:function(a,b){this.brange[a]=b},setProgram:function(a,b){this.pg[a]=b},setBend:function(a,b,c){c=this._tsConv(c);var d=100*this.brange[a]/127;this.bend[a]=(b-8192)*d/8192;for(var e=this.notetab.length-1;e>=0;--e){var f=this.notetab[e];if(f.ch==a)for(var g=f.o.length-1;g>=0;--g)f.o[g].frequency&&f.o[g].detune.setValueAtTime(this.bend[a],c)}},noteOn:function(a,b,c,d){return 0==c?void this.noteOff(a,b,d):(d=this._tsConv(d),9==a?void(b>=35&&b<=81&&this._note(d,a,b,c,this.drummap[b-35].p)):void this._note(d,a,b,c,this.program[this.pg[a]].p))},noteOff:function(a,b,c){if(9!=a){c=this._tsConv(c);for(var d=this.notetab.length-1;d>=0;--d){var e=this.notetab[d];c>=e.t&&e.ch==a&&e.n==b&&0==e.f&&(e.f=1,this.sustain[a]<64&&this._releaseNote(e,c))}}},_tsConv:function(a){return void 0==a||a<=0?(a=0,this.actx&&(a=this.actx.currentTime)):this.tsmode&&(a=.001*a-this.tsdiff),a},setTsMode:function(a){this.tsmode=a},send:function(a,b){var c=15&a[0],d=a[0]&-16;if(!(d<128||d>=256))switch(d){case 176:switch(a[1]){case 1:this.setModulation(c,a[2],b);break;case 7:this.setChVol(c,a[2],b);break;case 10:this.setPan(c,a[2],b);break;case 11:this.setExpression(c,a[2],b);break;case 64:this.setSustain(c,a[2],b);break;case 98:case 98:this.rpnidx[c]=16383;break;case 100:this.rpnidx[c]=896&this.rpnidx[c]|a[2];break;case 101:this.rpnidx[c]=127&this.rpnidx[c]|a[2]<<7;break;case 6:0==this.rpnidx[c]&&(this.brange[c]=(a[2]<<7)+(127&this.brange[c]));break;case 38:0==this.rpnidx[c]&&(this.brange[c]=896&this.brange[c]|a[2]);break;case 120:case 123:case 124:case 125:case 126:case 127:this.allSoundOff(c);break;case 121:this.resetAllControllers(c)}break;case 192:this.setProgram(c,a[1]);break;case 224:this.setBend(c,a[1]+(a[2]<<7),b);break;case 144:this.noteOn(c,a[1],a[2],b);break;case 128:this.noteOff(c,a[1],b)}},_createWave:function(a){for(var b=new Float32Array(a.length),c=new Float32Array(a.length),d=1;d<a.length;++d)b[d]=a[d];return this.actx.createPeriodicWave(c,b)},getAudioContext:function(){return this.actx},setAudioContext:function(a,b){this.audioContext=this.actx=a,this.dest=b,b||(this.dest=a.destination),this.tsdiff=.001*performance.now()-this.actx.currentTime,console.log("TSDiff:"+this.tsdiff),this.out=this.actx.createGain(),this.comp=this.actx.createDynamicsCompressor();var c=.5*this.actx.sampleRate|0;this.convBuf=this.actx.createBuffer(2,c,this.actx.sampleRate),this.noiseBuf={},this.noiseBuf.n0=this.actx.createBuffer(1,c,this.actx.sampleRate),this.noiseBuf.n1=this.actx.createBuffer(1,c,this.actx.sampleRate);
for(var d=this.convBuf.getChannelData(0),e=this.convBuf.getChannelData(1),f=this.noiseBuf.n0.getChannelData(0),g=this.noiseBuf.n1.getChannelData(0),h=0;h<c;++h)h/c<Math.random()&&(d[h]=Math.exp(-3*h/c)*(Math.random()-.5),e[h]=Math.exp(-3*h/c)*(Math.random()-.5)),f[h]=2*Math.random()-1;for(var i=0;i<64;++i){var j=10*Math.random()+1,k=10*Math.random()+1;for(h=0;h<c;++h){var l=Math.sin(h/c*2*Math.PI*440*j)*Math.sin(h/c*2*Math.PI*440*k);g[h]+=l/8}}for(this.useReverb&&(this.conv=this.actx.createConvolver(),this.conv.buffer=this.convBuf,this.rev=this.actx.createGain(),this.rev.gain.value=this.reverbLev,this.out.connect(this.conv),this.conv.connect(this.rev),this.rev.connect(this.comp)),this.setMasterVol(),this.out.connect(this.comp),this.comp.connect(this.dest),this.chvol=[],this.chmod=[],this.chpan=[],this.wave={w9999:this._createWave("w9999")},this.lfo=this.actx.createOscillator(),this.lfo.frequency.value=5,this.lfo.start(0),h=0;h<16;++h)this.chvol[h]=this.actx.createGain(),this.actx.createStereoPanner?(this.chpan[h]=this.actx.createStereoPanner(),this.chvol[h].connect(this.chpan[h]),this.chpan[h].connect(this.out)):(this.chpan[h]=null,this.chvol[h].connect(this.out)),this.chmod[h]=this.actx.createGain(),this.lfo.connect(this.chmod[h]),this.pg[h]=0,this.resetAllControllers(h);this.setReverbLev(),this.reset(),this.send([144,60,1]),this.send([144,60,0])}};for(var b in this.sy.properties)this[b]=this.sy.properties[b].value;this.setQuality(1),a&&(void 0!=a.useReverb&&(this.useReverb=a.useReverb),void 0!=a.quality&&this.setQuality(a.quality),void 0!=a.voices&&this.setVoices(a.voices)),this.ready()}